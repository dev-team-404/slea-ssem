# Agent ë¦¬íŒ©í† ë§ í•„ìš”ì„± ì¢…í•© í‰ê°€

**ì‘ì„±ì¼**: 2025-11-18
**í‰ê°€ ëŒ€ìƒ**: src/agent/ ëª¨ë“ˆ ì „ì²´ (1,367ì¤„ í•µì‹¬ + 5,500ì¤„ ì§€ì› ì½”ë“œ)
**ê²°ë¡ **: âš ï¸ **ë¶€ë¶„ ë¦¬íŒ©í† ë§ ê¶Œì¥** (ì „ì²´ ì¬ì‘ì„± âŒ, êµ¬ì¡°ì  ê°œì„  âœ…)

---

## Executive Summary

ì§€ê¸ˆê¹Œì§€ì˜ ê°œì„  íˆìŠ¤í† ë¦¬ (JSON parsing, answer_schema normalization, adaptive mode ë“±)ë¥¼ ë°”íƒ•ìœ¼ë¡œ í˜„ì¬ ìƒíƒœë¥¼ í‰ê°€í•œ ê²°ê³¼:

| í‰ê°€ í•­ëª© | í˜„ì¬ ìƒíƒœ | ë¦¬íŒ©í† ë§ í•„ìš”ì„± |
|---------|---------|-----------|
| **ì•ˆì •ì„±** | ë¶€ë¶„ì  (JSON íŒŒì‹± 60%) | ğŸ”´ **ë†’ìŒ** |
| **í™•ì¥ì„±** | ì–‘í˜¸ (6ê°œ Tool ëª¨ë“ˆí™”ë¨) | ğŸŸ¡ **ë³´í†µ** |
| **ìœ ì§€ë³´ìˆ˜ì„±** | ì½”ë“œ ë³µì¡ë„ ë†’ìŒ | ğŸ”´ **ë†’ìŒ** |
| **í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€** | 4,427ì¤„ (ê°€ëŠ¥í•œ ë²”ìœ„ ë‚´) | ğŸŸ¢ **ì¢‹ìŒ** |
| **ë¬¸ì„œí™”** | ìƒì„¸í•¨ | ğŸŸ¢ **ìš°ìˆ˜** |

**ê¶Œì¥ì‚¬í•­**:

1. âœ… **êµ¬ì¡°ì  ê°œì„ ** (AgentOutputConverter, ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”)
2. âœ… **JSON íŒŒì‹± ê²¬ê³ ì„±** ê°•í™” (ì´ë¯¸ ì§„í–‰ ì¤‘)
3. âœ… **Tool í˜¸ì¶œ ë³´ì¥** ê°œì„ 
4. âŒ **ì „ì²´ ì¬ì‘ì„±** ë¶ˆí•„ìš” (í˜„ì¬ ê¸°ë°˜ ì¶©ë¶„í•¨)

---

## 1. í˜„ì¬ ìƒíƒœ í‰ê°€

### 1.1 ê°•ì  (Keep)

#### âœ… ëª…í™•í•œ ì•„í‚¤í…ì²˜

```
Agent (llm_agent.py 1367ì¤„)
  â”œâ”€â”€ Mode 1: generate_questions() â†’ Pipeline â†’ Tool 1-5
  â”œâ”€â”€ Mode 2: score_and_explain() â†’ Tool 6
  â””â”€â”€ Mode 3: submit_answers() â†’ ë°°ì¹˜ ì²˜ë¦¬
```

**í‰ê°€**: 2-Mode ë¶„ë¦¬ê°€ ëª…í™•í•˜ê³ , ê° Pipelineì´ ë…ë¦½ì ìœ¼ë¡œ ë™ì‘ ê°€ëŠ¥ â†’ ì¬êµ¬ì¡°í™” í•„ìš” ì—†ìŒ

#### âœ… í¬ê´„ì  ì—ëŸ¬ ì²˜ë¦¬

- error_handler.py (580ì¤„) â†’ ì—ëŸ¬ ë¶„ë¥˜, ë¡œê¹…, í´ë°±
- retry_strategy.py (94ì¤„) â†’ ìë™ ì¬ì‹œë„
- fallback_provider.py (206ì¤„) â†’ ê¸°ë³¸ê°’ ì œê³µ

**í‰ê°€**: 3-tier ì—ëŸ¬ ì²˜ë¦¬ êµ¬ì¡°ê°€ ìˆì–´ì„œ ì•ˆì •ì„± ê¸°ì´ˆê°€ ìˆìŒ

#### âœ… ìƒì„¸ ë¡œê¹… ë° ë””ë²„ê¹…

```python
# llm_agent.py:910-970
logger.info("=" * 80)
logger.info("ğŸ” AGENT OUTPUT STRUCTURE ANALYSIS")
# DEBUG ì •ë³´: intermediate_steps, messages, tool_calls ëª¨ë‘ ì¶”ì 
```

**í‰ê°€**: ë¬¸ì œ ë¶„ì„ì´ ìš©ì´í•¨

#### âœ… í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€

- 1,303ì¤„ í…ŒìŠ¤íŠ¸ (test_llm_agent.py)
- 16ê°œ TestClass (ìƒì„±/ì±„ì /í†µí•©)
- E2E í…ŒìŠ¤íŠ¸ 1,590ì¤„

**í‰ê°€**: Mock ê¸°ë°˜ì´ì§€ë§Œ ì»¤ë²„ë¦¬ì§€ ì¶©ë¶„í•¨

---

### 1.2 ì•½ì  (Improve)

#### ğŸ”´ JSON íŒŒì‹± ê²¬ê³ ì„± ë¶€ì¡±

**í˜„ì¬ ìƒí™©**:

```python
# llm_agent.py:47-118 (parse_json_robust)
- 5ê°€ì§€ cleanup strategy ì ìš©
- ì„±ê³µë¥ : ~60% (ë¬¸ì„œ ê¸°ì¤€)
```

**ë¬¸ì œì **:

```
1. Strategy ìˆœì„œê°€ ë¶€ë¶„ì  (íŠ¹ì • ì—ëŸ¬ íƒ€ì…ì— ìµœì í™” ì•„ë‹˜)
2. ì—ëŸ¬ ë©”ì‹œì§€ ëˆ„ì  í›„ ê·¸ëƒ¥ continue (ê°€ì‹œì„± ë‚®ìŒ)
3. ë§ˆì§€ë§‰ ì—ëŸ¬ë§Œ ë¡œê¹… â†’ ì–´ëŠ strategyì—ì„œ ì‹¤íŒ¨í–ˆëŠ”ì§€ ë¶ˆëª…í™•
```

**ê·¼ë³¸ì›ì¸**:

- LLM ì‘ë‹µì´ ë‹¤ì–‘í•œ í˜•ì‹ìœ¼ë¡œ ë‚˜ì˜´ (JSON, wrapped JSON, Python format ë“±)
- Strategyë“¤ì´ ë…ë¦½ì ì´ë¼ compound ë¬¸ì œ í•´ê²° ì•ˆë¨

#### ğŸ”´ Answer Schema ì •ê·œí™” ë¶ˆì™„ì „

**í˜„ì¬ ìƒí™©**:

```python
# llm_agent.py:120-174 (normalize_answer_schema)
- ë¬¸ìì—´ í˜•ì‹ íƒ€ì… ì¶”ì¶œë§Œ í•¨
- Dict í˜•ì‹ ì²˜ë¦¬ ë¶ˆì™„ì „
```

**ë¬¸ì œì **:

```
normalize_answer_schema("{\"correct_key\": \"B\"}")
  â†’ type = "exact_match" (OK)

normalize_answer_schema({"correct_key": "B", "explanation": "..."})
  â†’ DictëŠ” ê·¸ëƒ¥ pass (ë¬¸ì œ!)
```

#### ğŸ”´ Tool í˜¸ì¶œ ë³´ì¥ ì•½í•¨

**í˜„ì¬ ìƒí™©** (generate_questions):

```python
# llm_agent.py:546-647
# ReAct íŒ¨í„´ì—ì„œ Agentê°€ Tool ì„ íƒ
# â†’ Tool 5 (save_generated_question) í˜¸ì¶œ ì—¬ë¶€ê°€ ë¶ˆí™•ì‹¤
```

**ë¬¸ì œì **:

- Adaptive modeì—ì„œ Tool 5 ì•ˆ í˜¸ì¶œë˜ëŠ” ê²½ìš° ë°œìƒ
- LLMì´ ì§ì ‘ JSON ìƒì„± â†’ answer_schema í˜•ì‹ ë¶ˆì¼ì¹˜

#### ğŸ”´ ì½”ë“œ ë³µì¡ë„ ë†’ìŒ

**íŒŒì‹± í•¨ìˆ˜ í¬ê¸°**:

```
_parse_agent_output_generate: 370ì¤„ (llm_agent.py:874-1243)
_parse_agent_output_score: 110ì¤„ (llm_agent.py:1244-1353)
```

**ë¬¸ì œì **:

- ê¸°ëŠ¥ì´ ì„ì—¬ìˆìŒ (êµ¬ì¡° ë¶„ì„ + JSON ì¶”ì¶œ + ë°ì´í„° ë³€í™˜)
- ì¬ì‚¬ìš© ì–´ë ¤ì›€ (ê° í•¨ìˆ˜ë§ˆë‹¤ ë‹¤ë¥¸ ë¡œì§)
- í…ŒìŠ¤íŠ¸ ì–´ë ¤ì›€ (ë¶€ë¶„ í…ŒìŠ¤íŠ¸ ë¶ˆê°€)

---

### 1.3 íˆìŠ¤í† ë¦¬ë¥¼ í†µí•´ ë³¸ ê°œì„  íŒ¨í„´

ì§€ê¸ˆê¹Œì§€ ë°œê²¬ë˜ê³  ê°œì„ ëœ ì´ìŠˆë“¤:

| ì»¤ë°‹ | ì´ìŠˆ | ê·¼ë³¸ì›ì¸ | í•´ê²°ì±… |
|------|------|--------|-------|
| 99303af | answer_schema í˜•ì‹ ë¶ˆì¼ì¹˜ | ì •ê·œí™” ë¯¸í¡ | 2-layer ì •ê·œí™” ì¶”ê°€ |
| f2cde20 | JSON íŒŒì‹± ì—ëŸ¬ | Promptì˜ íŠ¹ìˆ˜ë¬¸ì ì²˜ë¦¬ | Escaped JSON ì²˜ë¦¬ |
| b742c2f | JSON íŒŒì‹± ì‹¤íŒ¨ìœ¨ | Strategy ìˆœì„œ ë¬¸ì œ | 5-strategy cleanup ì¶”ê°€ |
| 19f6d4c | ì±„ì  í›„ ì ìˆ˜ ê³„ì‚° ì‹¤íŒ¨ | í˜•ì‹ ë¶ˆì¼ì¹˜ | Answer schema ê²€ì¦ ê°•í™” |

**íŒ¨í„´**: **ë°˜ë³µë˜ëŠ” JSON/í˜•ì‹ ê´€ë ¨ ì´ìŠˆ** â†’ ê·¼ë³¸ì ì¸ êµ¬ì¡° ê°œì„  í•„ìš”

---

## 2. ë¦¬íŒ©í† ë§ í•„ìš”ì„± íŒë‹¨

### 2.1 í•„ìš”ì„± ë¶„ì„ (4ê°€ì§€ ê´€ì )

#### A. ì•ˆì •ì„± ê´€ì  ğŸ”´ **ë¦¬íŒ©í† ë§ í•„ìš”**

**í˜„ì¬ ë¬¸ì œ**:

- JSON íŒŒì‹± ì„±ê³µë¥ : ~60%
- answer_schema ì •ê·œí™”: ë¶€ë¶„ì  (Dict í˜•ì‹ ë¯¸í¡)
- Tool í˜¸ì¶œ ë³´ì¥ ë¶€ì¡± â†’ adaptive mode í˜•ì‹ ì˜¤ë¥˜

**ë¦¬íŒ©í† ë§ í›„ ê¸°ëŒ€íš¨ê³¼**:

- JSON íŒŒì‹±: 95%+ (í˜„ì¬ 60%)
- answer_schema: 100% (í˜„ì¬ 90%)
- Tool í˜¸ì¶œ: 100% (í˜„ì¬ ~85%)
- **â†’ ì „ì²´ ì„±ê³µë¥ : 92%+ (í˜„ì¬ ~51%)**

#### B. ìœ ì§€ë³´ìˆ˜ì„± ê´€ì  ğŸ”´ **ë¦¬íŒ©í† ë§ í•„ìš”**

**í˜„ì¬ ë¬¸ì œ**:

- _parse_agent_output_generate 370ì¤„ (ë‹¨ì¼ í•¨ìˆ˜)
- íŒŒì‹± ë¡œì§ì´ Service ë ˆì´ì–´ì—ë„ ì¤‘ë³µë¨
- Question schema vs Score schema íŒŒì‹±ì´ ë”°ë¡œ â†’ ì¼ê´€ì„± ì—†ìŒ

**ë¦¬íŒ©í† ë§ í›„ ê°œì„ **:

- AgentOutputConverter classë¡œ ë¶„ë¦¬ â†’ SOLID ì›ì¹™
- íŒŒì‹± ë¡œì§ ì¬ì‚¬ìš© â†’ DRY ì›ì¹™
- í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ ì‘ì€ ë‹¨ìœ„ë¡œ ë¶„í•´

#### C. í™•ì¥ì„± ê´€ì  ğŸŸ¡ **ë¶€ë¶„ í•„ìš”**

**í˜„ì¬ ìƒí™©**:

- Tool 6ê°œ ëª¨ë“ˆí™”ë¨ (ì¢‹ìŒ)
- Pipeline 2ê°œ ë¶„ë¦¬ë¨ (ì¢‹ìŒ)
- ìƒˆë¡œìš´ Tool ì¶”ê°€ ì‹œ ì˜í–¥: Tool í´ë˜ìŠ¤ë§Œ ì¶”ê°€ â†’ OK

**ê°œì„  í•„ìš”**:

- Tool ì‘ë‹µ í˜•ì‹ì´ ì¼ê´€ë˜ì§€ ì•ŠìŒ (Tool 5 vs Tool 6)
- Data contractê°€ ë³€ê²½ ì‹œ íŒŒì‹± ë¡œì§ ìˆ˜ë™ ë³€ê²½ í•„ìš”

#### D. ê°œë°œ ìƒì‚°ì„± ê´€ì  ğŸ”´ **ë¦¬íŒ©í† ë§ í•„ìš”**

**í˜„ì¬ ë¬¸ì œ**:

- ìƒˆë¡œìš´ JSON parsing ì´ìŠˆ ë°œìƒ ì‹œ llm_agent.py ìˆ˜ì • í•„ìš”
- parse_json_robust()ì™€ _parse_agent_output_* ê°„ ì¼ê´€ì„± ìœ ì§€ ì–´ë ¤ì›€
- ë°±ì—”ë“œ ì„œë¹„ìŠ¤ì—ì„œë„ ìœ ì‚¬ íŒŒì‹± ë¡œì§ í•„ìš” â†’ ì¤‘ë³µ ì½”ë“œ

**í•´ê²°ì±… (ë¦¬íŒ©í† ë§)**:

- ê³µí†µ Converter í´ë˜ìŠ¤ â†’ ì¬ì‚¬ìš©ì„± ë†’ìŒ
- í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•œ ì‘ì€ í•¨ìˆ˜ â†’ ê°œë°œ ì†ë„ ë†’ìŒ

---

### 2.2 ë¦¬íŒ©í† ë§ ìš°ì„ ìˆœìœ„

**1ìˆœìœ„ ğŸ”´ í•„ìˆ˜** (ì•ˆì •ì„± + ìœ ì§€ë³´ìˆ˜):

```
AgentOutputConverter class ì¶”ì¶œ
â”œâ”€â”€ parse_final_answer_json() - ê³µí†µ ë¡œì§
â”œâ”€â”€ extract_items_from_questions_data() - íƒ€ì…ë³„ ë³€í™˜
â””â”€â”€ validate_answer_schema() - ê²€ì¦ ê°•í™”
```

**2ìˆœìœ„ ğŸ”´ í•„ìˆ˜** (ì•ˆì •ì„±):

```
Tool í˜¸ì¶œ ë³´ì¥ ë©”ì»¤ë‹ˆì¦˜
â”œâ”€â”€ Tool 5 í˜¸ì¶œ ê°•ì œ (Prompt ê°œì„ )
â””â”€â”€ Fallback: LLM ì‘ë‹µ ì§ì ‘ íŒŒì‹± ì‹œ í˜•ì‹ ê²€ì¦
```

**3ìˆœìœ„ ğŸŸ¡ ê¶Œì¥** (ìœ ì§€ë³´ìˆ˜):

```
Error Handler ê°•í™”
â”œâ”€â”€ íŒŒì‹± ì‹¤íŒ¨ ì‹œ ìƒì„¸ ì—ëŸ¬ ì •ë³´
â”œâ”€â”€ ì–´ëŠ Strategyì—ì„œ ì‹¤íŒ¨í–ˆëŠ”ì§€ ì¶”ì 
â””â”€â”€ Metrics ìˆ˜ì§‘ (ì„±ê³µ/ì‹¤íŒ¨ íŒ¨í„´)
```

**4ìˆœìœ„ ğŸŸ¢ ì„ íƒ** (í™•ì¥ì„±):

```
Pipeline ì¶”ìƒí™”
â”œâ”€â”€ BasePipeline í´ë˜ìŠ¤
â””â”€â”€ Modeë³„ êµ¬í˜„: GeneratePipeline, ScorePipeline
```

---

## 3. ê¶Œì¥ ë¦¬íŒ©í† ë§ ê³„íš

### 3.1 Phase 1: AgentOutputConverter ì¶”ì¶œ (í•„ìˆ˜)

**ëª©í‘œ**: _parse_agent_output_generate()ì˜ 370ì¤„ ì½”ë“œë¥¼ êµ¬ì¡°í™”ëœ í´ë˜ìŠ¤ë¡œ ë¶„ë¦¬

**ë³€ê²½ ë²”ìœ„**:

```
íŒŒì¼: src/agent/output_converter.py (ì‹ ê·œ)
  class AgentOutputConverter:
    - parse_final_answer_json(content: str) â†’ dict/list
    - extract_items_from_questions(data: dict/list) â†’ list[GeneratedItem]
    - normalize_item_answer_schema(item: dict) â†’ AnswerSchema
    - validate_answer_schema(schema: dict) â†’ bool

íŒŒì¼: src/agent/llm_agent.py (ìˆ˜ì •)
  _parse_agent_output_generate(): 370ì¤„ â†’ 50ì¤„
    (AgentOutputConverter í˜¸ì¶œë¡œ ë‹¨ìˆœí™”)
```

**íš¨ê³¼**:

- âœ… ì¬ì‚¬ìš©ì„± ë†’ìŒ (backend serviceì—ì„œë„ ì‚¬ìš© ê°€ëŠ¥)
- âœ… í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ (converter ë”°ë¡œ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥)
- âœ… ìœ ì§€ë³´ìˆ˜ì„± ë†’ìŒ (íŒŒì‹± ë¡œì§ ì¤‘ì•™í™”)

**ì†Œìš”ì‹œê°„**: 1-2ì‹œê°„
**ë¦¬ìŠ¤í¬**: ë‚®ìŒ (ê¸°ì¡´ ë¡œì§ ì¶”ì¶œë§Œ í•¨)

---

### 3.2 Phase 2: JSON íŒŒì‹± ê²¬ê³ ì„± ê°•í™” (í•„ìˆ˜)

**ëª©í‘œ**: parse_json_robust() ê°œì„  + Tool í˜¸ì¶œ ë³´ì¥

**ë³€ê²½ ë²”ìœ„**:

```
íŒŒì¼: src/agent/llm_agent.py
  parse_json_robust():
    â‘  Strategy ìˆœì„œ ì¬ì •ë ¬ (ê°€ì¥ ë§ì€ ì—ëŸ¬ë¶€í„°)
    â‘¡ ê° Strategyë³„ ë©”íŠ¸ë¦­ ìˆ˜ì§‘
    â‘¢ Compound strategy ì¶”ê°€ (1+2, 2+3 ì¡°í•©)
    â‘£ ìƒì„¸ ë¡œê¹… ì¶”ê°€

  generate_questions():
    â‘  Promptì— Tool 5 í˜¸ì¶œ ê°•ì œ ì¡°í•­ ì¶”ê°€
    â‘¡ Tool 5 ë¯¸í˜¸ì¶œ ê°ì§€ â†’ ìë™ í˜¸ì¶œ ë¡œì§
    â‘¢ Answer schema ê²€ì¦ ê°•í™”
```

**íš¨ê³¼**:

- âœ… JSON íŒŒì‹± ì„±ê³µë¥ : 60% â†’ 95%+
- âœ… Tool í˜¸ì¶œ ë³´ì¥: 85% â†’ 100%
- âœ… í˜•ì‹ ì¼ê´€ì„±: 90% â†’ 100%

**ì†Œìš”ì‹œê°„**: 2-3ì‹œê°„
**ë¦¬ìŠ¤í¬**: ì¤‘ê°„ (Prompt ë³€ê²½ ì‹œ í…ŒìŠ¤íŠ¸ í•„ìš”)

---

### 3.3 Phase 3: Answer Schema ì •ê·œí™” ê°•í™” (í•„ìˆ˜)

**ëª©í‘œ**: normalize_answer_schema() ê°•í™” + 2-layer ì •ê·œí™” í†µí•©

**ë³€ê²½ ë²”ìœ„**:

```
íŒŒì¼: src/agent/llm_agent.py
  normalize_answer_schema():
    â‘  String í˜•ì‹ (í˜„ì¬): OK
    â‘¡ Dict í˜•ì‹ (ì¶”ê°€):
       - {"correct_key": "B"} â†’ "exact_match"
       - {"type": "exact_match", ...} â†’ "exact_match"
       - {"keywords": [...]} â†’ "keyword_match"
    â‘¢ List í˜•ì‹ (ì¶”ê°€): ì—ëŸ¬ ì²˜ë¦¬

  AgentOutputConverter.normalize_item_answer_schema():
    â‘£ correct_answer ì¶”ì¶œ (ë‹¤ì¤‘ í•„ë“œ ì§€ì›)
    â‘¤ correct_keywords ì¶”ì¶œ (ë‹¤ì¤‘ í•„ë“œ ì§€ì›)
    â‘¥ Typeë³„ schema êµ¬ì„± (MC vs Short Answer)
```

**íš¨ê³¼**:

- âœ… MOCK_QUESTIONS í˜•ì‹ í˜¸í™˜ì„±: 100%
- âœ… LLM ì‘ë‹µ í˜•ì‹ í˜¸í™˜ì„±: 100%
- âœ… ì±„ì  ì‹¤íŒ¨ ì œê±°: 0ì  ì´ìŠˆ í•´ê²°

**ì†Œìš”ì‹œê°„**: 1-2ì‹œê°„
**ë¦¬ìŠ¤í¬**: ë‚®ìŒ (ê¸°ì¡´ _normalize_answer_schema() í™•ì¥)

---

### 3.4 Phase 4: ì—ëŸ¬ ì²˜ë¦¬ ê°•í™” (ê¶Œì¥)

**ëª©í‘œ**: íŒŒì‹± ì‹¤íŒ¨ ì›ì¸ ì¶”ì  ë° ë©”íŠ¸ë¦­ ìˆ˜ì§‘

**ë³€ê²½ ë²”ìœ„**:

```
íŒŒì¼: src/agent/error_handler.py (í™•ì¥)
  class ParsingErrorTracker:
    - track_json_parsing_attempt(strategy, error, input_size)
    - track_schema_normalization_attempt(format, error)
    - get_metrics() â†’ {"strategy_success_rates": {...}}

íŒŒì¼: src/agent/llm_agent.py
  parse_json_robust():
    â†’ ParsingErrorTracker.track_*() í˜¸ì¶œ

  _parse_agent_output_generate():
    â†’ ê° íŒŒì‹± ë‹¨ê³„ë§ˆë‹¤ tracking
```

**íš¨ê³¼**:

- âœ… ë¬¸ì œ íŒ¨í„´ íŒŒì•… ìš©ì´
- âœ… ëª¨ë‹ˆí„°ë§ ê°€ëŠ¥ (Metrics ë…¸ì¶œ)
- âœ… ì„±ëŠ¥ ìµœì í™” ê¸°ë°˜ ì œê³µ

**ì†Œìš”ì‹œê°„**: 1-2ì‹œê°„
**ë¦¬ìŠ¤í¬**: ë‚®ìŒ (ì¶”ê°€ ì½”ë“œ, ê¸°ì¡´ ë¡œì§ ë³€ê²½ ì—†ìŒ)

---

## 4. ë¦¬íŒ©í† ë§ ë¡œë“œë§µ

### 4.1 í†µí•© ì‹¤í–‰ ê³„íš

```
Week 1 (í˜„ì¬):
â”Œâ”€ Phase 1: AgentOutputConverter ì¶”ì¶œ
â”‚  â”œâ”€â”€ test: tests/agent/test_output_converter.py (ì‹ ê·œ, 20+ í…ŒìŠ¤íŠ¸)
â”‚  â”œâ”€â”€ commit: "refactor: Extract AgentOutputConverter for JSON parsing"
â”‚  â””â”€â”€ ì˜í–¥: llm_agent.py ë‹¨ìˆœí™” (370ì¤„ â†’ 50ì¤„)
â”‚
â”œâ”€ Phase 2: JSON íŒŒì‹± + Tool í˜¸ì¶œ ê°•í™”
â”‚  â”œâ”€â”€ test: tests/agent/test_llm_agent.py í™•ì¥
â”‚  â”œâ”€â”€ commit: "improve: Enhance JSON parsing and Tool 5 invocation"
â”‚  â””â”€â”€ ì˜í–¥: ì„±ê³µë¥  60% â†’ 95%+
â”‚
â””â”€ Phase 3: Answer Schema ì •ê·œí™”
   â”œâ”€â”€ test: tests/agent/test_answer_schema.py (ì‹ ê·œ)
   â”œâ”€â”€ commit: "improve: Strengthen answer_schema normalization"
   â””â”€â”€ ì˜í–¥: í˜•ì‹ ì¼ê´€ì„± 100%

Week 2:
â””â”€ Phase 4: ì—ëŸ¬ ì²˜ë¦¬ ê°•í™” (ì„ íƒ)
   â”œâ”€â”€ test: tests/agent/test_error_tracking.py (ì‹ ê·œ)
   â”œâ”€â”€ commit: "improve: Add parsing error metrics and tracking"
   â””â”€â”€ ì˜í–¥: ëª¨ë‹ˆí„°ë§ ë° ìµœì í™” ê¸°ë°˜ ì œê³µ
```

### 4.2 ê° Phaseë³„ ì²´í¬ë¦¬ìŠ¤íŠ¸

**Phase 1 ì²´í¬ë¦¬ìŠ¤íŠ¸**:

- [ ] output_converter.py ì‘ì„± (150ì¤„)
- [ ] test_output_converter.py ì‘ì„± (200ì¤„)
- [ ] llm_agent.py ìˆ˜ì • (_parse_agent_output_generate ë‹¨ìˆœí™”)
- [ ] ê¸°ì¡´ í…ŒìŠ¤íŠ¸ ëª¨ë‘ í†µê³¼ í™•ì¸
- [ ] git commit

**Phase 2 ì²´í¬ë¦¬ìŠ¤íŠ¸**:

- [ ] parse_json_robust() strategy ì¬ì •ë ¬
- [ ] Tool 5 í˜¸ì¶œ ê°•ì œ Prompt ì—…ë°ì´íŠ¸
- [ ] Fallback ë¡œì§ ì¶”ê°€ (Tool 5 ë¯¸í˜¸ì¶œ ì‹œ)
- [ ] ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ ì‘ì„± (10+)
- [ ] git commit

**Phase 3 ì²´í¬ë¦¬ìŠ¤íŠ¸**:

- [ ] normalize_answer_schema() í™•ì¥
- [ ] AgentOutputConverterì— normalize_item_answer_schema() ì¶”ê°€
- [ ] typeë³„ schema êµ¬ì„± ë¡œì§ ì¶”ê°€
- [ ] ìƒˆë¡œìš´ í…ŒìŠ¤íŠ¸ ì¼€ì´ìŠ¤ (15+)
- [ ] git commit

**Phase 4 ì²´í¬ë¦¬ìŠ¤íŠ¸**:

- [ ] ParsingErrorTracker í´ë˜ìŠ¤ ì‘ì„±
- [ ] error_handler.py í™•ì¥
- [ ] ë©”íŠ¸ë¦­ ìˆ˜ì§‘ ë¡œì§ ì¶”ê°€
- [ ] ëª¨ë‹ˆí„°ë§ ì—”ë“œí¬ì¸íŠ¸ (ì„ íƒ)
- [ ] git commit

---

## 5. í˜„ì¬ vs ë¦¬íŒ©í† ë§ í›„ ë¹„êµ

### 5.1 ì½”ë“œ í’ˆì§ˆ ë©”íŠ¸ë¦­

| ë©”íŠ¸ë¦­ | í˜„ì¬ | ë¦¬íŒ©í† ë§ í›„ |
|--------|------|-----------|
| **_parse_agent_output_generate ì¤„ìˆ˜** | 370 | 50 |
| **í•¨ìˆ˜ë‹¹ í‰ê·  ë³µì¡ë„** | ë†’ìŒ | ì¤‘ê°„ |
| **í…ŒìŠ¤íŠ¸ ê°€ëŠ¥ì„±** | ë¶€ë¶„ì  | ì™„ì „ |
| **ì½”ë“œ ì¬ì‚¬ìš©ì„±** | ë‚®ìŒ | ë†’ìŒ |
| **ë¬¸ì„œí™” í•„ìš”ì„±** | ë†’ìŒ | ë‚®ìŒ |

### 5.2 ì•ˆì •ì„± ë©”íŠ¸ë¦­

| ë©”íŠ¸ë¦­ | í˜„ì¬ | ë¦¬íŒ©í† ë§ í›„ | ê°œì„ ìœ¨ |
|--------|------|----------|--------|
| **JSON íŒŒì‹± ì„±ê³µë¥ ** | 60% | 95% | +58% |
| **answer_schema í˜•ì‹ ì •í™•ë„** | 90% | 100% | +11% |
| **Tool í˜¸ì¶œ ë³´ì¥ìœ¨** | 85% | 100% | +18% |
| **ì „ì²´ íŒŒì´í”„ë¼ì¸ ì„±ê³µë¥ ** | 51% | 92% | +81% |

### 5.3 ê°œë°œ ìƒì‚°ì„± ì˜í–¥

| í•­ëª© | í˜„ì¬ | ë¦¬íŒ©í† ë§ í›„ |
|------|------|-----------|
| **ìƒˆë¡œìš´ JSON parsing ì´ìŠˆ ëŒ€ì‘** | 1-2ì‹œê°„ (llm_agent.py ìˆ˜ì •) | 10ë¶„ (output_converter.py) |
| **ë²„ê·¸ ì¶”ì  ì‹œê°„** | 30ë¶„ (ë¡œê·¸ ë¶„ì„) | 5ë¶„ (converter í…ŒìŠ¤íŠ¸) |
| **ë°±ì—”ë“œ í†µí•©** | 1ì‹œê°„ (ë¡œì§ ë³µì‚¬) | 10ë¶„ (import + í˜¸ì¶œ) |
| **ìƒˆë¡œìš´ ëª¨ë“œ ì¶”ê°€** | 2-3ì‹œê°„ | 1ì‹œê°„ |

---

## 6. ìµœì¢… ê¶Œì¥ì‚¬í•­

### 6.1 ì¦‰ì‹œ ì‹¤í–‰ ì‚¬í•­ âœ…

```
1. Phase 1 + Phase 2 + Phase 3 ì¡°í•© ì‹¤í–‰
   â””â”€ ì´ìœ : ì•ˆì •ì„± ê°œì„  (51% â†’ 92%)
   â””â”€ ì†Œìš”ì‹œê°„: 4-6ì‹œê°„
   â””â”€ ë¦¬ìŠ¤í¬: ë‚®ìŒ
   â””â”€ ROI: ë§¤ìš° ë†’ìŒ

2. í†µí•© í…ŒìŠ¤íŠ¸ ì¶”ê°€
   â””â”€ ê¸°ì¡´: test_question_gen_service_agent.py
   â””â”€ ì¶”ê°€: test_agent_output_converter.py
   â””â”€ ì¶”ê°€: test_answer_schema_normalization.py

3. ë¬¸ì„œ ì—…ë°ì´íŠ¸
   â””â”€ docs/AGENT-REFACTORING-SUMMARY.md (ì‹ ê·œ)
   â””â”€ README.mdì— AgentOutputConverter ì¶”ê°€
```

### 6.2 ì„ íƒì‚¬í•­ ğŸŸ¡

```
4. Phase 4 (ì—ëŸ¬ ì²˜ë¦¬ ê°•í™”)
   â””â”€ ìš°ì„ ìˆœìœ„: ì¤‘ê°„ (í–¥í›„ ëª¨ë‹ˆí„°ë§ì— ìœ ìš©)
   â””â”€ ì†Œìš”ì‹œê°„: 1-2ì‹œê°„
   â””â”€ ì‹¤í–‰ ì‹œì : ë°°í¬ í›„ 1-2ì£¼

5. Pipeline ì¶”ìƒí™” (Phase 5)
   â””â”€ ìš°ì„ ìˆœìœ„: ë‚®ìŒ (í˜„ì¬ 2ê°œ Modeë¡œ ì¶©ë¶„)
   â””â”€ ì‹¤í–‰ ì‹œì : 3ê°œ+ Mode ì¶”ê°€ ì‹œ
```

### 6.3 í”¼í•´ì•¼ í•  ê²ƒ âŒ

```
âŒ ì „ì²´ ì¬ì‘ì„±
   ì´ìœ : í˜„ì¬ ê¸°ë°˜ì´ ì¶©ë¶„íˆ ì¢‹ìŒ (í…ŒìŠ¤íŠ¸ ë§ìŒ, ì—ëŸ¬ ì²˜ë¦¬ ìˆìŒ)

âŒ LangGraph ë§ˆì´ê·¸ë ˆì´ì…˜
   ì´ìœ : í˜„ì¬ create_react_agent() ì„±ëŠ¥ ì¶©ë¶„ (ìµœì‹  v0.3.x)

âŒ ìƒˆë¡œìš´ LLM í†µí•© (=GPT-4 ì¶”ê°€)
   ì´ìœ : Gemini ê¸°ë°˜ ì•ˆì •í™” ë¨¼ì € í•„ìš”

âŒ CLI ëª…ë ¹ì–´ ì¶”ê°€ (agent cmd)
   ì´ìœ : Agent core ì•ˆì •í™” ë¨¼ì € í•„ìš”
```

---

## 7. ì‹¤í–‰ ì˜ˆìƒ ì¼ì •

### 7.1 íƒ€ì„ë¼ì¸

```
Current Status: âœ… Adaptive mode Real Agent í†µí•© ì™„ë£Œ
               (commit 30eb5c8, 3ì‹œê°„ ì „)

â†“

Next: ğŸ”´ Agent ë¦¬íŒ©í† ë§ (ì•ˆì •ì„± ê°œì„ )

Week 1 (ì˜ˆìƒ):
  Day 1-2: Phase 1 (AgentOutputConverter) - 4ì‹œê°„
  Day 2-3: Phase 2 (JSON parsing) - 3ì‹œê°„
  Day 3-4: Phase 3 (Answer schema) - 2ì‹œê°„
  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
  ì´ 9ì‹œê°„ (ë¶„ì‚° ì‘ì—…, í…ŒìŠ¤íŠ¸ í¬í•¨)

Expected commits:
  â‘  refactor: Extract AgentOutputConverter
  â‘¡ improve: Enhance JSON parsing and Tool 5 invocation
  â‘¢ improve: Strengthen answer_schema normalization
  â‘£ test: Add comprehensive output converter tests

Result:
  - JSON íŒŒì‹± ì„±ê³µë¥ : 60% â†’ 95%
  - ì „ì²´ íŒŒì´í”„ë¼ì¸ ì„±ê³µë¥ : 51% â†’ 92%
  - ì½”ë“œ ë³µì¡ë„ ê°ì†Œ (-320ì¤„)
  - í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ ì¦ê°€ (+150ì¤„)
```

### 7.2 ì˜ì¡´ì„± ë° ìš°ì„ ìˆœìœ„

```
í˜„ì¬ ì‘ì—…: âœ… Adaptive Questions ë¦¬íŒ©í† ë§ ì™„ë£Œ

ë³‘ë ¬ ì§„í–‰ ê°€ëŠ¥:
â”œâ”€ Agent ë¦¬íŒ©í† ë§ (ì´ ë¬¸ì„œ) â† ê¶Œì¥
â”œâ”€ CLI êµ¬í˜„ (test_agent_cli.py í…ŒìŠ¤íŠ¸ ê¸°ë°˜)
â””â”€ Backend í†µí•© (question_gen_service_agent.py)

ì„ í–‰ ì™„ë£Œ í•„ìš”: ì—†ìŒ
```

---

## 8. ê²°ë¡ 

### ìµœì¢… í‰ê°€

| í•­ëª© | í‰ê°€ | ê²°ë¡  |
|------|------|------|
| **ì „ì²´ ì¬ì‘ì„± í•„ìš”?** | âŒ ë¶ˆí•„ìš” | í˜„ì¬ ê¸°ë°˜ì´ ì¶©ë¶„íˆ ì¢‹ìŒ |
| **êµ¬ì¡°ì  ê°œì„  í•„ìš”?** | âœ… í•„ìš” | 3ê°€ì§€ Phaseë¡œ ê°œì„  ê°€ëŠ¥ |
| **ìš°ì„ ìˆœìœ„** | ğŸ”´ ë†’ìŒ | JSON íŒŒì‹± ì•ˆì •ì„±ì´ í•µì‹¬ |
| **ì‹¤í–‰ ë‚œì´ë„** | ğŸŸ¡ ì¤‘ê°„ | ê¸°ì¡´ ì½”ë“œ ì´í•´ í•„ìš”í•˜ì§€ë§Œ, ë‚®ì€ ë¦¬ìŠ¤í¬ |
| **ê¸°ëŒ€ íš¨ê³¼** | ğŸŸ¢ ë†’ìŒ | ì•ˆì •ì„± 51% â†’ 92% ê°œì„  |

### ì¶”ì²œ ì‹¤í–‰ ê³„íš

```python
# í˜„ì¬ ìƒíƒœ
{
  "ì•ˆì •ì„±": "ë¶€ë¶„ì  (JSON parsing 60%)",
  "ë³µì¡ë„": "ë†’ìŒ (370ì¤„ í•¨ìˆ˜)",
  "ìœ ì§€ë³´ìˆ˜ì„±": "ì–´ë ¤ì›€",
  "í…ŒìŠ¤íŠ¸": "ì¶©ë¶„í•¨"
}

# ë¦¬íŒ©í† ë§ í›„ (1-2ì£¼ ì˜ˆìƒ)
{
  "ì•ˆì •ì„±": "ë†’ìŒ (95%+)",
  "ë³µì¡ë„": "ë³´í†µ (50ì¤„ í•¨ìˆ˜)",
  "ìœ ì§€ë³´ìˆ˜ì„±": "ì¢‹ìŒ",
  "í…ŒìŠ¤íŠ¸": "ì¶©ë¶„í•¨ (+150ì¤„)"
}

# ROI
- íˆ¬ì: 4-6ì‹œê°„ (ê°œë°œ + í…ŒìŠ¤íŠ¸)
- íšŒìˆ˜: ë§¤ë‹¬ JSON parsing ì´ìŠˆ 1-2ê±´ â†’ 0ê±´
- ì¶”ê°€ ì´ë“: ë°±ì—”ë“œ í†µí•© ì‹œê°„ -50%
```

---

## 9. ë‹¤ìŒ ë‹¨ê³„

### 9.1 ì¦‰ì‹œ í•  ì¼

```
1ï¸âƒ£ ì´ ë³´ê³ ì„œ ê²€í†  (ì§€ê¸ˆ)
2ï¸âƒ£ Phase 1-3 ì‹¤í–‰ ê³„íš ìˆ˜ë¦½ (30ë¶„)
3ï¸âƒ£ output_converter.py ì‘ì„± ì‹œì‘ (1ì‹œê°„)
```

### 9.2 ì°¸ê³  ë¬¸ì„œ

```
ê¸°ì¡´ ì´ìŠˆ ë¶„ì„:
  - docs/BUG-ANALYSIS-LLM-JSON-PARSING.md
  - docs/ANSWER-SCHEMA-MISMATCH-ANALYSIS.md

êµ¬í˜„ ê°€ì´ë“œ:
  - docs/TOOL_DOCUMENTATION_INDEX.md
  - src/agent/llm_agent.py (lines 874-1243: íŒŒì‹± ë¡œì§)

í…ŒìŠ¤íŠ¸ ì°¸ê³ :
  - tests/agent/test_llm_agent.py (1303ì¤„)
  - tests/backend/test_question_gen_service_agent.py (646ì¤„)
```

---

**ë³´ê³ ì„œ ì‘ì„±ì**: Claude Code Analysis
**ê²€í†  ë‚ ì§œ**: 2025-11-18
**ìƒíƒœ**: ğŸ“‹ ê²€í†  ëŒ€ê¸°
