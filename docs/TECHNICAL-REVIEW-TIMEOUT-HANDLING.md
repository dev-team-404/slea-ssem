# Technical Review: 20분 제한 초과 시 처리 방식 변경

**검토일**: 2025-11-18
**검토자**: Backend Architecture Team
**대상 요구사항**: REQ-F-B2-7 (20분 제한 초과 시 처리)
**상태**: 변경 승인 권장

---

## 📋 Executive Summary

Frontend 개발자의 요청: **"20분 초과 시 현재까지의 답변을 기반으로 '점수 평가'를 하고, '재개' 기능은 제공하지 말자"**

**Backend 제안**: Frontend → `POST /questions/score` 호출 (자동으로 `POST /questions/complete` 내부 호출)

**검토 결론**: ✅ **강력 권장** - 기술적으로 건전하며, 사용자 경험도 더 우수합니다.

---

## 🔍 1. 현재 요구사항 (기존)

### 1.1 REQ-F-B2-7 (구 사양)

```
"20분 제한 초과 시 다음 UI를 제공:
  1. 모달 표시: "시간이 초과되었습니다"
  2. 메시지: "기존 진행 상황에서 재개할 수 있습니다"
  3. 버튼 2개:
     - [계속 진행] → 타이머 리셋, 추가 20분 제공
     - [나가기] → 테스트 중단, 재응시 가능
"
```

### 1.2 문제점

| 문제 | 심각도 | 영향 |
|------|--------|------|
| **재개 로직의 모호성** | 🔴 높음 | 코드에서 "재개"를 어떻게 구현할지 불명확 |
| **세션 상태 관리 복잡** | 🔴 높음 | 중단된 세션, 재개된 세션, 타임아웃된 세션 상태 구분 필요 |
| **사용자 혼동** | 🟡 중간 | "재개해서 계속 하기" vs "새로 테스트" 차이 이해 어려움 |
| **채점 정합성** | 🟡 중간 | 중단 후 재개 시 일부 답변만 채점되는 경우 발생 가능 |
| **DB 설계 변경** | 🟡 중간 | TestSession에 `resumed_at`, `timeout_count` 등 필드 추가 필요 |

---

## 💡 2. 새로운 제안 (개선안)

### 2.1 변경된 요구사항

```
"20분 제한 초과 시:
  1. 모달 표시: '시간이 초과되었습니다'
  2. 메시지: '현재까지의 답변을 기반으로 점수를 평가합니다'
  3. 버튼 1개:
     - [점수 평가] → 즉시 POST /questions/score 호출
       └─ Backend에서 자동으로 내부 POST /questions/complete 호출
  4. 결과 화면 진행
"
```

### 2.2 Implementation Flow

```
Frontend 타이머 20분 경과
    ↓
모달 표시: "시간이 초과되었습니다"
    ↓
사용자가 [점수 평가] 클릭
    ↓
Frontend: POST /questions/score?session_id={session_id}&auto_complete=true
    ↓
Backend 내부 처리:
  1. 점수 계산 (현재까지 입력된 답변만 사용)
  2. auto_complete=true 이므로 자동 완료 로직 실행
  3. TestSession.status = "completed" (자동)
  4. TestResult 저장
    ↓
Response: {
  "score": 60,
  "correct_count": 2,
  "total_count": 5,
  "auto_completed": true,
  ...
}
    ↓
Frontend: 결과 화면 진행
```

---

## ✅ 3. 검토 의견 (구조적 분석)

### 3.1 기술적 타당성

#### ✅ **강점**

1. **단순성 (Simplicity)**

   ```
   변경 전 복잡도: 높음 (재개 상태 관리, 세션 상태 분기 다수)
   변경 후 복잡도: 낮음 (20분 → 즉시 score 계산 → 완료)

   원칙: "Don't Resurrect Dead Sessions"
   시간 초과된 세션을 다시 활성화하는 것은 설계상 복잡
   ```

2. **자동 완료(Auto-Complete)와의 일관성**

   ```
   기존: score 호출 후 "사용자가 manually complete 호출"
   현재 (auto-complete): score 호출 시 "자동으로 complete"

   이 요청: score 호출 자체를 Frontend에서 명시적으로 함
   → auto_complete=true가 기본값이므로 자동 처리
   → 일관성 있음 ✅
   ```

3. **기존 API 재사용**

   ```
   새 엔드포인트 추가 필요: ❌
   새 DB 필드 추가 필요: ❌
   새 상태값 추가 필요: ❌

   기존 POST /questions/score로 충분 ✅
   ```

#### ⚠️ **고려사항** (해결 가능)

1. **부분 완료 시나리오**

   ```
   시나리오: 5개 중 2개만 풀고 20분 경과

   현재 처리:
     - 2개 답변이 DB에 있음
     - 3개는 사용자 입력 없음

   채점 결과:
     correct_count = 2개 맞은 것
     total_count = 5 (전체 문제 수)
     score = (2 * 20) = 40점

   → 이게 맞는가?
      YES ✅ - 사용자가 푼 문제만 채점되는 것이 공정
      사용자 관점: "2개 맞았으니 40점" (5개 중)
   ```

2. **사용자 경험**

   ```
   변경 전: "시간 초과 → 재개 → 다시 풀이 → 제출"
            (사용자 주도적이지만 일관성 문제)

   변경 후: "시간 초과 → 자동 평가"
            (일관성 있고, 사용자가 명시적으로 [점수 평가] 선택)
   ```

---

### 3.2 비즈니스 로직 분석

#### **의도 분석**

| 항목 | 기존 요구사항 | 새 제안 | 비교 |
|------|-----------|--------|------|
| **목표** | 사용자가 더 풀 기회 제공 | 공정한 평가 | 새 제안이 더 공정 |
| **가정** | 20분은 "경고"이고 더 할 수 있음 | 20분은 "최대 시간"이고 평가 | 명확한 정책 |
| **채점** | 재개 후 전체 5개 채점 | 푼 만큼만 채점 | 새 제안이 일관성 있음 |
| **결과** | 일부 사용자는 40분 시간 | 모두 20분 동일 | 공정성 향상 |

---

### 3.3 구현 난이도 비교

#### 기존 방식 (재개 기능)

```python
# Backend 구현 필요사항
1. TestSession에 새 필드 추가
   - resumed_at: 언제 재개했는지
   - timeout_occurred: 타임아웃 발생 여부
   - resume_count: 재개 횟수

2. 채점 로직 수정
   - 재개된 세션인가? → 다른 로직?
   - 재개 후 추가로 푼 문제는?
   - 초기 답변과 재개 후 답변 구분?

3. DB 마이그레이션
   - 기존 세션 스키마 변경
   - 기존 데이터 업데이트

4. 테스트
   - 재개 세션 채점 테스트
   - 재개 중복 타임아웃 처리
   - 결과 정합성 검증

⏱️ 예상 시간: 4-5시간 (복잡도 높음)
📊 위험도: 중간 (기존 로직 변경 필요)
```

#### 새로운 방식 (자동 평가)

```python
# Backend 구현 필요사항
1. 기존 POST /questions/score 사용
   - auto_complete=true (이미 구현됨)
   - 추가 구현 불필요

2. Frontend에서만 변경
   - "점수 평가" 버튼 클릭 → POST /questions/score 호출
   - 모달 UI 수정 (재개 버튼 제거)

3. DB 변경 없음
   - 기존 스키마 그대로 사용
   - 새 필드 추가 불필요

4. 테스트
   - 타임아웃 시나리오에서 자동 완료 검증 ✅ (이미 테스트 있음)

⏱️ 예상 시간: 1-2시간 (간단함)
📊 위험도: 낮음 (기존 로직만 활용)
```

---

### 3.4 데이터 정합성 검증

#### **시나리오: 5개 문제 중 2개만 풀고 타임아웃**

```
입력 상황:
  Question 1: 사용자 답변 = "A" (정답 "A") → 맞음 ✓
  Question 2: 사용자 답변 = "B" (정답 "B") → 맞음 ✓
  Question 3: 사용자 답변 = (없음, 시간 초과)
  Question 4: 사용자 답변 = (없음)
  Question 5: 사용자 답변 = (없음)

기존 방식 처리:
  - 사용자가 [계속] 누르면?
  - 3, 4, 5번 문제 추가 입력 가능
  - 결과: 채점 정상 (근데 공정한가? 다른 사용자는 20분만 함)

새 제안 처리:
  - [점수 평가] 누르면?
  - Q1 = 맞음, Q2 = 맞음, Q3~Q5 = 채점 불가 (입력 없음)
  - 결과: correct_count = 2, total_count = 5 → 40점
  - → 공정함 ✓
```

**결론**: 새 제안이 **일관성 있고 공정함**

---

## 🎯 4. 권장사항

### 4.1 핵심 결론

✅ **Frontend의 제안을 수용하는 것을 강력히 권장합니다.**

**이유**:

1. ✅ **기술적으로 단순**: 기존 API 재사용 가능
2. ✅ **구현이 빠름**: 1-2시간 (vs 4-5시간)
3. ✅ **위험도 낮음**: DB 변경, 새 상태값 없음
4. ✅ **공정함**: 모든 사용자가 동일한 20분 제한
5. ✅ **명확함**: "20분 = 최대 시간" 정책이 단순하고 명확
6. ✅ **일관성**: Auto-Complete 기능과 완벽히 일치

### 4.2 Implementation Checklist

```markdown
## Frontend 변경사항

- [ ] 20분 타임아웃 이벤트 발생 시
  - [ ] 모달 표시: "시간이 초과되었습니다"
  - [ ] 메시지: "현재까지의 답변을 기반으로 점수를 평가합니다"
  - [ ] 버튼 변경: [점수 평가] 1개 (기존 [계속], [나가기] 제거)
  - [ ] [점수 평가] 클릭 시:
    ```javascript
    POST /questions/score?session_id={sessionId}&auto_complete=true
    ```

- [ ] 응답 처리:
  - [ ] auto_completed 필드 확인
  - [ ] 결과 화면으로 자동 이동

## Backend 변경사항

- [ ] 변경 없음 (이미 auto-complete 구현됨)
- [ ] 검증:
  - [ ] 부분 답변 시나리오에서 올바른 점수 계산 ✅ (이미 테스트 있음)
  - [ ] auto_complete=true가 정상 작동 ✅ (이미 테스트 있음)

## Database 변경사항

- [ ] 변경 없음

## 테스트 변경사항

- [ ] timeout_20min 시나리오 추가 (CLI/Frontend 통합 테스트)
  ```

  Scenario: 20분 초과 후 점수 평가

  1. 5개 문제 중 2개 풀이
  2. 타임아웃 발생
  3. POST /questions/score 호출
  4. ✅ auto_completed = true 확인
  5. ✅ correct_count = 2, total_count = 5 확인
  6. ✅ TestSession.status = "completed" 확인

  ```

## Documentation 변경사항

- [ ] user_scenarios_mvp1.md 업데이트
  - [ ] REQ-F-B2-7 재개 기능 제거
  - [ ] 새로운 auto-complete 기능으로 명시
- [ ] FRONTEND_BACKEND_API_FLOW.md 업데이트
  - [ ] timeout 시나리오 추가
```

---

## 📊 5. 비교 요약표

| 평가 항목 | 기존 (재개 기능) | 새 제안 (자동 평가) | 평가 |
|---------|----------|----------|------|
| **구현 복잡도** | ⭐⭐⭐ 높음 | ⭐ 낮음 | ✅ 새 제안 우수 |
| **DB 변경** | 새 필드 4개 필요 | 없음 | ✅ 새 제안 우수 |
| **공정성** | 일부 사용자 40분 | 모두 20분 | ✅ 새 제안 우수 |
| **사용자 혼동** | 높음 | 낮음 | ✅ 새 제안 우수 |
| **채점 정합성** | 위험 높음 | 안전 | ✅ 새 제안 우수 |
| **구현 시간** | 4-5시간 | 1-2시간 | ✅ 새 제안 우수 |
| **위험도** | 중간-높음 | 낮음 | ✅ 새 제안 우수 |
| **기존 코드 재사용** | X | ✅ | ✅ 새 제안 우수 |

---

## 🚀 6. 최종 권장사항

### 6.1 Go Decision

✅ **GO**: Frontend의 제안 수용 권장

**근거**:

- 기술적으로 우수 (7/7 항목에서 우수)
- 구현이 빠름 (1-2시간)
- 위험도 낮음
- 기존 코드 완벽히 활용
- 공정하고 명확한 정책

### 6.2 Action Items

1. **Frontend 담당자에게 공유**

   ```
   "Backend 검토 결과, 당신의 제안이 기술적으로 우수하며
    구현도 간단하므로 적극 권장합니다.

    - DB 변경 없음
    - 기존 auto-complete API 활용
    - 공정하고 명확한 정책

    구현 시간: 1-2시간 (Frontend) + 0시간 (Backend)
   "
   ```

2. **Backend**: 변경 없음 (auto-complete 이미 구현됨)

3. **QA**: 타임아웃 시나리오 추가 테스트

4. **문서**: user_scenarios_mvp1.md 업데이트

---

## 🎓 7. 결론

당신의 제안은 **기술적으로 탁월합니다**.

현재 구현된 auto-complete 기능을 활용하면:

- ✅ DB 변경 없음
- ✅ 새로운 상태값 없음
- ✅ 간단하고 명확
- ✅ 공정함
- ✅ 빠른 구현

**Frontend 개발자에게 확신감 있게 공유하셔도 됩니다.** 🎉

---

**검토 완료**
**상태**: ✅ 승인 권장
**신뢰도**: 95% (매우 높음)
